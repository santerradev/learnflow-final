<%- include('../partials/header_auth', { pageTitle: 'Cadastro', formWidth: 'max-w-2xl' }) %>

    <h2 class="text-xl sm:text-2xl font-bold text-center text-gray-900 dark:text-white mb-2">Criar sua conta</h2>
    <p class="text-center text-sm sm:text-base text-gray-600 dark:text-gray-400 mb-4 sm:mb-6">Junte-se à nossa plataforma de ensino</p>

    <!-- Mensagem de ERRO (só aparece se existir) -->
    <% if (typeof error !== 'undefined' && error && error.length > 0) { %>
        <div class="bg-red-50 border border-red-200 text-red-700 dark:bg-red-900/20 dark:border-red-800 dark:text-red-400 px-4 py-3 rounded-lg mb-4 flex items-start" role="alert">
            <i class="fas fa-exclamation-circle mr-3 mt-0.5 flex-shrink-0"></i>
            <span class="text-sm"><%= error %></span>
        </div>
    <% } %>

    <form id="cadastroForm" class="space-y-4" action="/auth/cadastro" method="POST" enctype="multipart/form-data">
        
        <!-- LINHA 1: Nome e Email -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- Nome Completo -->
            <div>
                <label for="nome" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Nome completo</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-user text-gray-400 text-sm"></i>
                    </div>
                    <input id="nome" 
                           name="nome" 
                           type="text" 
                           required 
                           minlength="3"
                           placeholder="Seu nome completo"
                           class="block w-full pl-10 pr-4 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 dark:bg-gray-700 dark:text-white transition">
                </div>
            </div>

            <!-- Email -->
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Email</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-envelope text-gray-400 text-sm"></i>
                    </div>
                    <input id="email" 
                           name="email" 
                           type="email" 
                           required 
                           placeholder="seu@email.com"
                           class="block w-full pl-10 pr-4 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 dark:bg-gray-700 dark:text-white transition">
                </div>
            </div>
        </div>

        <!-- LINHA 2: Instituição e Tipo de Usuário -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- Instituição -->
            <div>
                <label for="instituicao" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Instituição</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-university text-gray-400 text-sm"></i>
                    </div>
                    <select id="instituicao" 
                            name="instituicao" 
                            required
                            class="block w-full pl-10 pr-10 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 dark:bg-gray-700 dark:text-white transition appearance-none">
                        <option value="">Selecione</option>
                        <option value="IFSUL_Gravatai">IFSUL - Gravataí</option>
                        <option value="Outro">Outra</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                    </div>
                </div>
            </div>

            <!-- Tipo de Usuário -->
            <div>
                <label for="tipo" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Tipo de usuário</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-user-tag text-gray-400 text-sm"></i>
                    </div>
                    <select id="tipo" 
                            name="tipo" 
                            required
                            class="block w-full pl-10 pr-10 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 dark:bg-gray-700 dark:text-white transition appearance-none">
                        <option value="">Selecione</option>
                        <option value="aluno">Estudante</option>
                        <option value="professor">Professor</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- LINHA 3: Senha e Confirmar Senha -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- Senha -->
            <div>
                <label for="senha" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Senha</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-lock text-gray-400 text-sm"></i>
                    </div>
                    <input id="senha" 
                           name="senha" 
                           type="password" 
                           required 
                           minlength="8"
                           placeholder="Crie uma senha forte"
                           class="block w-full pl-10 pr-12 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 dark:bg-gray-700 dark:text-white transition">
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer" onclick="togglePassword('senha')">
                        <i id="senha-icon" class="fas fa-eye text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition text-sm"></i>
                    </div>
                </div>
            </div>

            <!-- Confirmar Senha -->
            <div>
                <label for="confirmar_senha" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Confirmar senha</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-lock text-gray-400 text-sm"></i>
                    </div>
                    <input id="confirmar_senha" 
                           name="confirmar_senha" 
                           type="password" 
                           required 
                           placeholder="Digite novamente"
                           class="block w-full pl-10 pr-12 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 dark:bg-gray-700 dark:text-white transition">
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer" onclick="togglePassword('confirmar_senha')">
                        <i id="confirmar_senha-icon" class="fas fa-eye text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition text-sm"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- LINHA 4: Validações e Foto -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- Coluna 1: Validações -->
            <div>
                <div class="h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-1">
                    <div id="strengthBar" class="h-1.5 rounded-full transition-all duration-300"></div>
                </div>
                <p id="strengthText" class="text-xs mb-2 font-medium"></p>
                
                <div class="space-y-1 text-xs">
                    <p id="req-length" class="flex items-center text-gray-600 dark:text-gray-400">
                        <i class="fas fa-circle fa-xs mr-2 w-3"></i>
                        Mínimo 8 caracteres
                    </p>
                    <p id="req-upper" class="flex items-center text-gray-600 dark:text-gray-400">
                        <i class="fas fa-circle fa-xs mr-2 w-3"></i>
                        Uma letra maiúscula
                    </p>
                    <p id="req-number" class="flex items-center text-gray-600 dark:text-gray-400">
                        <i class="fas fa-circle fa-xs mr-2 w-3"></i>
                        Um número
                    </p>
                    <p id="req-symbol" class="flex items-center text-gray-600 dark:text-gray-400">
                        <i class="fas fa-circle fa-xs mr-2 w-3"></i>
                        Um símbolo (@#$!%*?&)
                    </p>
                </div>
            </div>

            <!-- Coluna 2: Match + Foto -->
            <div class="space-y-3">
                <p id="matchText" class="text-xs font-medium min-h-[20px]"></p>
                
                <div>
                    <label for="foto_perfil" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">
                        Foto de perfil <span class="text-xs text-gray-500">(opcional)</span>
                    </label>
                    <input id="foto_perfil" 
                           name="foto_perfil" 
                           type="file" 
                           accept="image/*"
                           class="block w-full text-xs border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white file:mr-3 file:py-2 file:px-3 file:rounded-l-lg file:border-0 file:text-xs file:font-semibold file:bg-teal-50 file:text-teal-700 hover:file:bg-teal-100 dark:file:bg-teal-900 dark:file:text-teal-300 transition cursor-pointer">
                </div>
            </div>
        </div>

        <!-- Botão Cadastrar -->
        <div class="pt-2">
            <button type="submit" 
                    class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-teal-600 hover:bg-teal-700 dark:bg-teal-500 dark:hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition duration-150 ease-in-out transform hover:scale-[1.01] active:scale-[0.99]">
                Criar conta
            </button>
        </div>
    </form>
    
    <!-- Link para Login -->
    <p class="mt-6 text-center text-sm text-gray-600 dark:text-gray-400">
        Já tem uma conta?
        <a href="/auth/login" class="font-medium text-teal-600 hover:text-teal-500 dark:text-teal-400 dark:hover:text-teal-300 transition">
            Entrar
        </a>
    </p>

    <script>
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const icon = document.getElementById(fieldId + '-icon');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        const senhaInput = document.getElementById('senha');
        const strengthBar = document.getElementById('strengthBar');
        const strengthText = document.getElementById('strengthText');
        const reqLength = document.getElementById('req-length');
        const reqUpper = document.getElementById('req-upper');
        const reqNumber = document.getElementById('req-number');
        const reqSymbol = document.getElementById('req-symbol');

        senhaInput.addEventListener('input', function() {
            const senha = this.value;
            let strength = 0;

            const hasLength = senha.length >= 8;
            const hasUpper = /[A-Z]/.test(senha);
            const hasNumber = /[0-9]/.test(senha);
            const hasSymbol = /[@$!%*?&#]/.test(senha);

            updateRequirement(reqLength, hasLength);
            updateRequirement(reqUpper, hasUpper);
            updateRequirement(reqNumber, hasNumber);
            updateRequirement(reqSymbol, hasSymbol);

            if (hasLength) strength++;
            if (hasUpper) strength++;
            if (hasNumber) strength++;
            if (hasSymbol) strength++;

            if (strength === 0) {
                strengthBar.style.width = '0%';
                strengthBar.className = 'h-1.5 rounded-full transition-all duration-300';
                strengthText.textContent = '';
            } else if (strength <= 2) {
                strengthBar.style.width = '33%';
                strengthBar.className = 'h-1.5 rounded-full transition-all duration-300 bg-red-500';
                strengthText.textContent = 'Senha fraca';
                strengthText.className = 'text-xs mb-2 text-red-600 dark:text-red-400 font-medium';
            } else if (strength === 3) {
                strengthBar.style.width = '66%';
                strengthBar.className = 'h-1.5 rounded-full transition-all duration-300 bg-yellow-500';
                strengthText.textContent = 'Senha média';
                strengthText.className = 'text-xs mb-2 text-yellow-600 dark:text-yellow-400 font-medium';
            } else {
                strengthBar.style.width = '100%';
                strengthBar.className = 'h-1.5 rounded-full transition-all duration-300 bg-green-500';
                strengthText.textContent = 'Senha forte';
                strengthText.className = 'text-xs mb-2 text-green-600 dark:text-green-400 font-medium';
            }
        });

        function updateRequirement(element, isValid) {
            const icon = element.querySelector('i');
            if (isValid) {
                element.classList.remove('text-gray-600', 'dark:text-gray-400');
                element.classList.add('text-green-600', 'dark:text-green-400');
                icon.classList.remove('fa-circle');
                icon.classList.add('fa-check-circle');
            } else {
                element.classList.remove('text-green-600', 'dark:text-green-400');
                element.classList.add('text-gray-600', 'dark:text-gray-400');
                icon.classList.remove('fa-check-circle');
                icon.classList.add('fa-circle');
            }
        }

        const confirmarSenhaInput = document.getElementById('confirmar_senha');
        const matchText = document.getElementById('matchText');

        confirmarSenhaInput.addEventListener('input', function() {
            if (this.value === '') {
                matchText.textContent = '';
                return;
            }
            
            if (this.value === senhaInput.value) {
                matchText.textContent = '✓ As senhas coincidem';
                matchText.className = 'text-xs font-medium text-green-600 dark:text-green-400 min-h-[20px]';
            } else {
                matchText.textContent = '✗ As senhas não coincidem';
                matchText.className = 'text-xs font-medium text-red-600 dark:text-red-400 min-h-[20px]';
            }
        });

        document.getElementById('cadastroForm').addEventListener('submit', function(e) {
            const senha = senhaInput.value;
            const confirmarSenha = confirmarSenhaInput.value;
            const instituicao = document.getElementById('instituicao').value;

            if (!instituicao) {
                e.preventDefault();
                if (window.showErrorModal) {
                    showErrorModal('Campo obrigatório', 'Por favor, selecione sua instituição.');
                } else {
                    alert('Por favor, selecione sua instituição.');
                }
                return;
            }

            const hasLength = senha.length >= 8;
            const hasUpper = /[A-Z]/.test(senha);
            const hasNumber = /[0-9]/.test(senha);
            const hasSymbol = /[@$!%*?&#]/.test(senha);

            if (!hasLength || !hasUpper || !hasNumber || !hasSymbol) {
                e.preventDefault();
                if (window.showErrorModal) {
                    showErrorModal(
                        'Senha inválida', 
                        'A senha deve ter:<br>• Mínimo 8 caracteres<br>• Uma letra maiúscula<br>• Um número<br>• Um símbolo (@#$!%*?&)'
                    );
                } else {
                    alert('A senha não atende aos requisitos mínimos de segurança.');
                }
                return;
            }

            if (senha !== confirmarSenha) {
                e.preventDefault();
                if (window.showErrorModal) {
                    showErrorModal('Senhas não coincidem', 'As senhas digitadas são diferentes. Por favor, verifique.');
                } else {
                    alert('As senhas não coincidem.');
                }
                return;
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('[role="alert"]');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.transition = 'opacity 0.5s ease-out';
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 500);
                }, 5000);
            });
        });
    </script>

<%- include('../partials/footer_auth') %>